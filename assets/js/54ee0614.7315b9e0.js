"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[5945],{55858:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>f});var r=t(76687);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var p=r.createContext({}),s=function(e){var n=r.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},u=function(e){var n=s(e.components);return r.createElement(p.Provider,{value:n},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,a=e.originalType,p=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=s(t),m=o,f=c["".concat(p,".").concat(m)]||c[m]||d[m]||a;return t?r.createElement(f,i(i({ref:n},u),{},{components:t})):r.createElement(f,i({ref:n},u))}));function f(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var a=t.length,i=new Array(a);i[0]=m;var l={};for(var p in n)hasOwnProperty.call(n,p)&&(l[p]=n[p]);l.originalType=e,l[c]="string"==typeof e?e:o,i[1]=l;for(var s=2;s<a;s++)i[s]=t[s];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},76080:(e,n,t)=>{t.d(n,{Z:()=>i});var r=t(76687),o=t(64923);const a="tabItem_EvUg";function i(e){var n=e.children,t=e.hidden,i=e.className;return r.createElement("div",{role:"tabpanel",className:(0,o.Z)(a,i),hidden:t},n)}},74404:(e,n,t)=>{t.d(n,{Z:()=>N});var r=t(7375),o=t(76687),a=t(64923),i=t(74840),l=t(18775),p=t(87233),s=t(78550),u=t(20242);function c(e){return function(e){return o.Children.map(e,(function(e){if((0,o.isValidElement)(e)&&"value"in e.props)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')}))}(e).map((function(e){var n=e.props;return{value:n.value,label:n.label,attributes:n.attributes,default:n.default}}))}function d(e){var n=e.values,t=e.children;return(0,o.useMemo)((function(){var e=null!=n?n:c(t);return function(e){var n=(0,s.l)(e,(function(e,n){return e.value===n.value}));if(n.length>0)throw new Error('Docusaurus error: Duplicate values "'+n.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(e),e}),[n,t])}function m(e){var n=e.value;return e.tabValues.some((function(e){return e.value===n}))}function f(e){var n=e.queryString,t=void 0!==n&&n,r=e.groupId,a=(0,l.k6)(),i=function(e){var n=e.queryString,t=void 0!==n&&n,r=e.groupId;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!r)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=r?r:null}({queryString:t,groupId:r});return[(0,p._X)(i),(0,o.useCallback)((function(e){if(i){var n=new URLSearchParams(a.location.search);n.set(i,e),a.replace(Object.assign({},a.location,{search:n.toString()}))}}),[i,a])]}function h(e){var n,t,r,a,i=e.defaultValue,l=e.queryString,p=void 0!==l&&l,s=e.groupId,c=d(e),h=(0,o.useState)((function(){return function(e){var n,t=e.defaultValue,r=e.tabValues;if(0===r.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!m({value:t,tabValues:r}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+t+'" but none of its children has the corresponding value. Available values are: '+r.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return t}var o=null!=(n=r.find((function(e){return e.default})))?n:r[0];if(!o)throw new Error("Unexpected error: 0 tabValues");return o.value}({defaultValue:i,tabValues:c})})),v=h[0],b=h[1],g=f({queryString:p,groupId:s}),k=g[0],y=g[1],C=(n=function(e){return e?"docusaurus.tab."+e:null}({groupId:s}.groupId),t=(0,u.Nk)(n),r=t[0],a=t[1],[r,(0,o.useCallback)((function(e){n&&a.set(e)}),[n,a])]),N=C[0],w=C[1],x=function(){var e=null!=k?k:N;return m({value:e,tabValues:c})?e:null}();return(0,o.useLayoutEffect)((function(){x&&b(x)}),[x]),{selectedValue:v,selectValue:(0,o.useCallback)((function(e){if(!m({value:e,tabValues:c}))throw new Error("Can't select invalid tab value="+e);b(e),y(e),w(e)}),[y,w,c]),tabValues:c}}var v=t(8643);const b="tabList_zrX3",g="tabItem_td0b";function k(e){var n=e.className,t=e.block,l=e.selectedValue,p=e.selectValue,s=e.tabValues,u=[],c=(0,i.o5)().blockElementScrollPositionUntilNextRender,d=function(e){var n=e.currentTarget,t=u.indexOf(n),r=s[t].value;r!==l&&(c(n),p(r))},m=function(e){var n,t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":var r,o=u.indexOf(e.currentTarget)+1;t=null!=(r=u[o])?r:u[0];break;case"ArrowLeft":var a,i=u.indexOf(e.currentTarget)-1;t=null!=(a=u[i])?a:u[u.length-1]}null==(n=t)||n.focus()};return o.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.Z)("tabs",{"tabs--block":t},n)},s.map((function(e){var n=e.value,t=e.label,i=e.attributes;return o.createElement("li",(0,r.Z)({role:"tab",tabIndex:l===n?0:-1,"aria-selected":l===n,key:n,ref:function(e){return u.push(e)},onKeyDown:m,onClick:d},i,{className:(0,a.Z)("tabs__item",g,null==i?void 0:i.className,{"tabs__item--active":l===n})}),null!=t?t:n)})))}function y(e){var n=e.lazy,t=e.children,r=e.selectedValue;if(t=Array.isArray(t)?t:[t],n){var a=t.find((function(e){return e.props.value===r}));return a?(0,o.cloneElement)(a,{className:"margin-top--md"}):null}return o.createElement("div",{className:"margin-top--md"},t.map((function(e,n){return(0,o.cloneElement)(e,{key:n,hidden:e.props.value!==r})})))}function C(e){var n=h(e);return o.createElement("div",{className:(0,a.Z)("tabs-container",b)},o.createElement(k,(0,r.Z)({},e,n)),o.createElement(y,(0,r.Z)({},e,n)))}function N(e){var n=(0,v.Z)();return o.createElement(C,(0,r.Z)({key:String(n)},e))}},46659:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>u,default:()=>h,frontMatter:()=>s,metadata:()=>c,toc:()=>m});var r=t(7375),o=t(38374),a=(t(76687),t(55858)),i=t(74404),l=t(76080),p=["components"],s={title:"Composer API",description:"micro-lc composer API",sidebar_label:"Composer API",sidebar_position:30},u=void 0,c={unversionedId:"api/composer-api",id:"api/composer-api",title:"Composer API",description:"micro-lc composer API",source:"@site/docs/api/composer-api.md",sourceDirName:"api",slug:"/api/composer-api",permalink:"/api/composer-api",draft:!1,editUrl:"https://github.com/micro-lc/documentation/edit/main/docs/api/composer-api.md",tags:[],version:"current",lastUpdatedBy:"Umberto Toniolo",sidebarPosition:30,frontMatter:{title:"Composer API",description:"micro-lc composer API",sidebar_label:"Composer API",sidebar_position:30},sidebar:"api",previous:{title:"Extensions",permalink:"/api/micro-lc-api/extensions"}},d={},m=[{value:"<code>premount</code>",id:"premount",level:3},{value:"<code>createComposerContext</code>",id:"createcomposercontext",level:3},{value:"<code>render</code>",id:"render",level:3},{value:"Standalone usage",id:"standalone-usage",level:2}],f={toc:m};function h(e){var n=e.components,t=(0,o.Z)(e,p);return(0,a.kt)("wrapper",(0,r.Z)({},f,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Any HTML element mounted in ",(0,a.kt)("micro-lc",null)," via ",(0,a.kt)("a",{parentName:"p",href:"/docs/guides/layout"},"layout")," or\n",(0,a.kt)("a",{parentName:"p",href:"/docs/guides/layout#mount-point"},"mount point"),", or any\n",(0,a.kt)("a",{parentName:"p",href:"/docs/guides/applications/compose"},"composable application")," is provided with the property ",(0,a.kt)("inlineCode",{parentName:"p"},"composerApi"),", which\nprovides the same dynamic capability for ",(0,a.kt)("a",{parentName:"p",href:"/docs/concepts/composition"},"mounting HTML subtrees")," ",(0,a.kt)("micro-lc",null),"\nitself uses under the hood."),(0,a.kt)("p",null,"The composer API is an object with two methods:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"premount")," which flattens polymorphic configurations and injects import maps, and"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"createComposerContext")," which builds an appender that can be called by assigning a root HTML DOM appending the\ndynamically configured HTML DOM as subtree of the root."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"render")," wraps ",(0,a.kt)("inlineCode",{parentName:"li"},"lit-html")," ",(0,a.kt)("inlineCode",{parentName:"li"},"render")," method and injects a ",(0,a.kt)("a",{parentName:"li",href:"/docs/guides/applications/compose#properties-injection"},"context"))),(0,a.kt)("h3",{id:"premount"},(0,a.kt)("inlineCode",{parentName:"h3"},"premount")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"interface ComposerApi {\n  // ... rest of the API\n  premount: (\n    config: PluginConfiguration,\n    proxyWindow?: ImportShimContext,\n    reporter?: (err: unknown) => void\n  ) => Promise<ResolvedConfig>\n}\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"premount")," allows to reduce the\n",(0,a.kt)("a",{parentName:"p",href:"localhost:3000/docs/guides/applications/compose#plugin-configuration"},(0,a.kt)("inlineCode",{parentName:"a"},"PluginConfiguration")," type")," to the following\n",(0,a.kt)("inlineCode",{parentName:"p"},"ResolvedConfig")," type"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"interface ResolvedConfig {\n  content: Content\n  sources: {\n    importmap?: ImportMap\n    uris: string[]\n  }\n}\n")),(0,a.kt)("p",null,"the optional ",(0,a.kt)("inlineCode",{parentName:"p"},"proxyWindow")," which defaults to the current ",(0,a.kt)("inlineCode",{parentName:"p"},"window")," must implement the ",(0,a.kt)("inlineCode",{parentName:"p"},"importShim")," interface, allows\nto override the importmap features, namely to set a no-op behaviour or select an iframe window. Notice that the\ninterface is equivalent to"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"interface ImportShimContext {\n  importShim<D, E extends Record<string, unknown>>(\n    uri: string, parentUrl?: string\n  ): Promise<{ default: D } & E>\n}\n")),(0,a.kt)("p",null,"After being called, ",(0,a.kt)("inlineCode",{parentName:"p"},"premount")," ensures all import maps declared are available and ",(0,a.kt)("inlineCode",{parentName:"p"},"uris")," sources have been fetched and\ntheir code run. If there is no ",(0,a.kt)("inlineCode",{parentName:"p"},"sources")," in the ",(0,a.kt)("inlineCode",{parentName:"p"},"PluginConfiguration"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"premount")," is a no-operation.\nMoreover an error reporter can be injected since ",(0,a.kt)("inlineCode",{parentName:"p"},"premount")," will not throw on errors."),(0,a.kt)("h3",{id:"createcomposercontext"},(0,a.kt)("inlineCode",{parentName:"h3"},"createComposerContext")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"interface ComposerApi {\n  // ... rest of the API\n  createComposerContext: (\n    content: Content,\n    options: ComposerOptions\n  ) => Promise<ComposerContextAppender>\n}\n")),(0,a.kt)("p",null,"Once ",(0,a.kt)("inlineCode",{parentName:"p"},"premount")," has been run, if needed, ",(0,a.kt)("inlineCode",{parentName:"p"},"createComposerContext")," provides a callback for appending the DOM\nconfigured in ",(0,a.kt)("inlineCode",{parentName:"p"},"content"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"type ComposerContextAppender = (container: HTMLElement | DocumentFragment, options?: RenderOptions) => void\n")),(0,a.kt)("p",null,"where ",(0,a.kt)("inlineCode",{parentName:"p"},"container")," is the root element that will be used to append the composed subtree and ",(0,a.kt)("inlineCode",{parentName:"p"},"options"),"\nrefer to optional features provided by the ",(0,a.kt)("a",{parentName:"p",href:"https://lit.dev/docs/api/templates/#render"},(0,a.kt)("inlineCode",{parentName:"a"},"lit-html")," ",(0,a.kt)("inlineCode",{parentName:"a"},"render")," method"),"."),(0,a.kt)("p",null,"Finally, ",(0,a.kt)("inlineCode",{parentName:"p"},"options")," in ",(0,a.kt)("inlineCode",{parentName:"p"},"createComposerContext")," is the object to interact with when the compiler needs to be\ninstructed to recognize some properties as special context. This feature allows to inject JS context avoiding eval and\nworks according to the ",(0,a.kt)("a",{parentName:"p",href:"/docs/guides/applications/compose#interpolated-properties"},"composability principles"),"."),(0,a.kt)("h3",{id:"render"},(0,a.kt)("inlineCode",{parentName:"h3"},"render")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"interface ComposerApi {\n  // ... rest of the API\n  render: (\n    config: ResolvedConfig,\n    container: HTMLElement,\n    context: Record<string, unknown> = {}\n  ) => Promise<ComposerContextAppender>\n}\n")),(0,a.kt)("p",null,"Alternatively, if the use case requires to append a ",(0,a.kt)("inlineCode",{parentName:"p"},"ResolvedConfig")," to a ",(0,a.kt)("inlineCode",{parentName:"p"},"container")," html element\nand inject a ",(0,a.kt)("inlineCode",{parentName:"p"},"context")," of properties, ",(0,a.kt)("inlineCode",{parentName:"p"},"render")," provides a useful shortcut."),(0,a.kt)("h2",{id:"standalone-usage"},"Standalone usage"),(0,a.kt)("p",null,"The composer API can be directly injected in your browser as a module by adding a script import from CDN source\nor in your code as a ",(0,a.kt)("inlineCode",{parentName:"p"},"dependency"),"."),(0,a.kt)("p",null,"To add it to your codebase: "),(0,a.kt)(i.Z,{groupId:"pkg-manager",mdxType:"Tabs"},(0,a.kt)(l.Z,{value:"npm",label:"npm",default:!0,mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"npm install @micro-lc/composer\n"))),(0,a.kt)(l.Z,{value:"yarn",label:"yarn",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"yarn add @micro-lc/composer\n")))),(0,a.kt)("p",null,"Otherwise, add to your ",(0,a.kt)("inlineCode",{parentName:"p"},"index.html")," the following script:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-html"},'  <script type="importmap">\n    {\n      "imports": {\n        "@micro-lc/composer": "https://cdn.jsdelivr.net/npm/@micro-lc/composer@latest/dist/bundle/index.min.js"\n      }\n    }\n  <\/script>\n')),(0,a.kt)("p",null,"and then use it in your scripts:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-html"},'<body>\n  <div id="root"></div>\n  <script type="module">\n    import {render} from \'@micro-lc/composer\'\n\n    (async function () {\n      const root = document.getElementById(\'root\')\n\n      render({content: "Hello \ud83d\udc4b"}, root)\n    })()\n  <\/script>\n</body>\n')),(0,a.kt)("p",null,"in case your browser does not support modules we recommend to add ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/guybedford/es-module-shims"},"es-module-shims"),"."))}h.isMDXComponent=!0}}]);